#!/bin/bash

# Pre-installation script - cleanup previous installation

CURRENT_USER=$(stat -f "%Su" /dev/console)
USER_HOME=$(eval echo ~$CURRENT_USER)

# Stop existing services
sudo -u $CURRENT_USER launchctl unload "$USER_HOME/Library/LaunchAgents/com.fx.resource-monitor.plist" 2>/dev/null || true
pkill -f resource-monitor 2>/dev/null || true
pkill -f ResourceMonitor 2>/dev/null || true

# Remove old login item if exists
sudo -u $CURRENT_USER osascript -e 'tell application "System Events" to delete login item "ResourceMonitor"' 2>/dev/null || true

echo "Cleanup complete, proceeding with installation..."
exit 0
